<app-second-nav></app-second-nav>

<div class="container my-4" *ngIf="courseData">
  <h2 class="mb-4 text-primary">Edit Course</h2>

  <!-- View Mode -->
  <div *ngIf="!isEditing">
    <div class="card p-3 mb-3">
      <img [src]="courseData.thumbnailUrl" alt="Thumbnail" class="img-fluid mb-3" style="max-width: 200px">
      <p><strong>Title:</strong> {{ courseData.title }}</p>
      <p><strong>Type:</strong> {{ courseData.type === 1 ? 'Recorded' : 'Live' }}</p>
      <p><strong>Level:</strong> {{ getLevelText(courseData.level) }}</p>
      <p><strong>Target Audience:</strong> {{ courseData.targetAudience }}</p>
      <p><strong>Price:</strong> {{ courseData.price }} {{ courseData.currency }}</p>
      <p><strong>Language:</strong> {{ courseData.language }}</p>
      <p><strong>Category:</strong> {{ courseData.category?.name }}</p>
    </div>

    <div *ngFor="let section of courseData.sections; let i = index" class="card p-3 mb-3">
      <h5 class="text-primary">Section {{ i + 1 }}: {{ section.title }}</h5>
      <div *ngFor="let lecture of section.lectures; let j = index" class="border-top pt-2">
        <p><strong>Lecture {{ j + 1 }}:</strong> {{ lecture.title }}</p>
        <video *ngIf="lecture.videoUrl" [src]="lecture.videoUrl" controls style="max-width: 300px;"></video>
      </div>
    </div>

    <div class="text-end">
      <button class="btn btn-outline-primary" (click)="isEditing = true">Edit Course</button>
    </div>
  </div>

  <!-- Edit Mode -->
  <div *ngIf="isEditing">
    <div class="card p-3 mb-3">
      <label>Title</label>
      <input class="form-control mb-2" [(ngModel)]="courseData.title">

      <label>Thumbnail</label>
      <input type="file" class="form-control mb-2" (change)="onThumbnailChange($event)">
      <img *ngIf="courseData.thumbnailUrl" [src]="courseData.thumbnailUrl" class="img-thumbnail mt-2" style="max-width: 200px;">

      <label>Level</label>
      <select class="form-select mb-2" [(ngModel)]="courseData.level">
        <option [ngValue]="1">Beginner</option>
        <option [ngValue]="2">Intermediate</option>
        <option [ngValue]="3">Advanced</option>
      </select>

      <label>Target Audience</label>
      <input class="form-control mb-2" [(ngModel)]="courseData.targetAudience">

      <label>Price</label>
      <input class="form-control mb-2" [(ngModel)]="courseData.price" type="number">
    </div>

    <div *ngFor="let section of courseData.sections; let i = index" class="card p-3 mb-3">
      <label>Section {{ i + 1 }} Title</label>
      <input class="form-control mb-2" [(ngModel)]="section.title">

      <div *ngFor="let lecture of section.lectures; let j = index" class="border-top pt-2">
        <label>Lecture {{ j + 1 }} Title</label>
        <input class="form-control mb-2" [(ngModel)]="lecture.title">

        <label>Lecture Video</label>
        <input type="file" class="form-control mb-2" (change)="onLectureVideoChange($event, i, j)">
        <video *ngIf="lecture.videoUrl" [src]="lecture.videoUrl" controls style="max-width: 300px;"></video>
      </div>
    </div>

    <div class="text-end">
      <button class="btn btn-success" (click)="saveChanges()">Save</button>
    </div>
  </div>
</div>
