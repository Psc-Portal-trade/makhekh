<div class="d-flex">
<app-sidebar></app-sidebar>
<div class="container dashboard-container mt-4 mb-5">

  <div class="d-flex align-items-center">
    <div class="position-relative text-end my-3">

      <div class="first-letter">

            <!-- لو في صورة -->
<img *ngIf="profileImg && profileImg !== '../../assets/download.jfif'"
     [src]="profileImg"
     class="rounded-circle"
     style="width: 50px; height: 50px;" />

<!-- لو مفيش صورة -->
<span *ngIf="profileImg === '../../assets/download.jfif'">
  {{ firstLetter }}
</span>
           <div class="profile-menu">
          <div class="text-center">
            <div class="d-flex align-items-center mb-3 gap-3">
              <div class="first-letterr">
                <span class="rounded-circle  text-white d-flex justify-content-center align-items-center" style="width: 50px; height: 50px; font-size: 24px;">

            <!-- لو في صورة -->
<img *ngIf="profileImg && profileImg !== '../../assets/download.jfif'"
     [src]="profileImg"
     class="rounded-circle"
     style="width: 50px; height: 50px;" />

<!-- لو مفيش صورة -->
<span *ngIf="profileImg === '../../assets/download.jfif'">
  {{ firstLetter }}
</span>
                </span>
              </div>
              <div class="text-start">
              <h5 class="mb-0">{{fullName}}</h5>
                    <p class="text-muted mb-0">{{email}}</p>
              </div>
            </div>
           </div>
          <ul class="list-group list-group-flush">
            <li class="list-group-item" routerLink="studentHome">{{ "second-navbar.home" | transloco }}</li>
            <li class="list-group-item">{{ "second-navbar.my courses" | transloco }}</li>
            <li class="list-group-item" routerLink="cart">{{ "second-navbar.My Cart" | transloco }} </li>
            <li class="list-group-item" routerLink="wishedList">{{ "second-navbar.Wishlist" | transloco }}</li>
            <li class="list-group-item" >{{ "second-navbar.Instructor Dashboard" | transloco }}</li>
            <li class="divider"></li>

            <li class="list-group-item" >{{ "second-navbar.Notifications" | transloco }}</li>
            <li class="list-group-item">{{ "second-navbar.Messages" | transloco }}</li>
            <li class="divider"></li>

            <li class="list-group-item">{{ "second-navbar.Account Settings" | transloco }}</li>
            <li class="list-group-item">{{ "second-navbar.Payment Methods" | transloco }}</li>
            <li class="divider"></li>

            <li class="list-group-item"  (click)="changeLang()">{{ "second-navbar.Language" | transloco }}</li>
            <li class="divider"></li>

            <li class="list-group-item">{{ "second-navbar.Help and Support" | transloco }}</li>
            <li class="list-group-item text-danger" (click)="logout()"> {{ "second-navbar.Log out" | transloco }}</li>
          </ul>

        </div>
      </div>

    </div>

  <div class="mx-3 second-sec">
    <i class="fa-solid fa-bell"></i>
    <!-- <a class="pe-3 text-decoration-none text-black " routerLink="student-profile">  student View  <i class="fa-solid fa-people-arrows px-1"></i></a> -->
  </div>

  </div>



    <!-- Main Content -->
    <div class="main-content">
      <!-- Header Section -->
      <div class="header container d-flex justify-content-between ">
        <h2>{{ 'dashboard.createQuiz' | transloco }}</h2>
        <a routerLink="quiz">
            <button class="btn btn-primary" >{{ 'dashboard.getStarted' | transloco }}</button>
          </a>
      </div>
      <div class="container mt-4">
        <div class="row">
          <div class="col-md-4 mb-4" *ngFor="let quiz of quizzes">
            <div class="card h-100 shadow">
              <img src="../../assets/course1.png" class="card-img-top" alt="Quiz Image">
              <div class="card-body d-flex flex-column align-items-center">
                <h5 class="card-title text-center">{{ quiz.title }}</h5>
                <button class="btn btn-primary mt-2 fs-6 text-center " (click)="openModal(quiz)">
                  {{ 'quiz.view_details' | transloco }}
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
  <div id="quizModal" class="modal" tabindex="-1" style="display: none;">
  <div class="modal-dialog modal-lg">
    <button type="button" class="btn-close position-absolute top-0 end-0 m-3" (click)="closeModal()"></button>

    <div class="modal-content p-3">
      <div class="modal-header d-flex justify-content-between">
        <div>
          <h5 class="modal-title">{{ 'quiz.create' | transloco }}</h5></div>
<div><button class="btn btn-close " (click)="closeModal()">X</button></div>

      </div>
      <div class="modal-body">
        <form [formGroup]="quizForm">
          <div class="mb-3">
            <label class="form-label">{{ 'quiz.course_name' | transloco }}</label>
            <input type="text" formControlName="courseName" class="form-control" [readonly]="true">
          </div>

          <div class="mb-3">
            <label class="form-label">{{ 'quiz.description' | transloco }}</label>
            <textarea formControlName="examDescription" class="form-control" [readonly]="true"></textarea>
          </div>
          <div class="mb-3">
            <label class="form-label">{{ 'quiz.category' | transloco }}</label>
            <select formControlName="categoryId" class="form-select" [disabled]="true">
              <option *ngFor="let category of categories" [value]="category.id">
                {{ category.name }}
              </option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">{{ 'quiz.quiz_type' | transloco }}</label>
            <input type="text" formControlName="quizType" class="form-control" [readonly]="true">
          </div>

          <div class="mb-3">
            <label class="form-label">{{ 'quiz.duration' | transloco }}</label>
            <input type="number" formControlName="duration" class="form-control" [readonly]="true">
          </div>

          <div class="mb-3">
            <label class="form-label">{{ 'quiz.attempts' | transloco }}</label>
            <input type="number" formControlName="attempts" class="form-control" [readonly]="true">
          </div>
          <div class="mb-3">
            <label class="form-label">{{ 'quiz.passing_score' | transloco }}</label>
            <input type="number" class="form-control" formControlName="passingScore">
          </div>

          <div class="mb-3">
            <label class="form-label">{{ 'quiz.is_free' | transloco }}</label>
            <input type="checkbox" formControlName="isFree" [readonly]="true" class="m-2">
          </div>

          <div class="mb-3" *ngIf="!quizForm.get('isFree')?.value">
            <label class="form-label">{{ 'quiz.price' | transloco }}</label>
            <input type="number" formControlName="price" class="form-control" [readonly]="true">
          </div>
        
          
            <!-- Questions List -->
      <div formArrayName="questions">
        <div *ngFor="let question of questions.controls; let i = index" [formGroupName]="i" class="border p-3 mb-2 rounded bg-light">
          
          <label class="form-label">{{ 'quiz.question' | transloco }} {{ i + 1 }}</label>
          <input type="text" class="form-control" formControlName="text"> 
         
      
          <!-- MCQ Section -->
          <ng-container *ngIf="question.get('type')?.value === 'mcq'">
            <div class="mt-3">
              <label class="form-label">{{ 'quiz.options' | transloco }}</label>
              <div formArrayName="options">
                <div *ngFor="let option of getOptions(i).controls; let j = index" [formGroupName]="j" class="form-check d-flex align-items-center gap-2 mb-2">
                  <input
                    type="radio"
                    class="form-check-input"
                    [value]="j"
                    [formControl]="asFormControl(questions.at(i).get('correctOptionIndex'))"
                  />
                  <input
                    type="text"
                    class="form-control"
                    formControlName="optionValue"
                    [placeholder]="'quiz.option' | transloco : { value: j + 1 }"
                  />
                </div>
              </div>
            </div>
          </ng-container>
       
          <!-- Essay or common -->
           <label class="form-label mt-3">{{ 'quiz.answer_explanation' | transloco }}</label>
          <textarea class="form-control" formControlName="answerExplanation"></textarea>
       <div class="mt-2">
            <label class="form-label">{{ 'quiz.marks' | transloco }}</label>
            <input type="number"
                   class="form-control w-25"
                   formControlName="marks"
                   min="1"
                   placeholder="مثلاً: 5">
          </div>
          <button type="button" class="btn btn-danger btn-sm mt-2" (click)="removeQuestion(i)">
            {{ 'quiz.remove_question' | transloco }}
          </button>
        </div>
      </div>
      <div class="mt-3 d-flex flex-column gap-2 align-items-start">
        <button type="button" *ngIf="quizType === 1"
                class="btn btn-primary fs-6 p-3"
                (click)="addQuestion('mcq')">
          {{ 'quiz.add_mcq_question' | transloco }}
        </button>
      
        <button type="button" *ngIf="quizType === 2"
                class="btn btn-secondary p-3"
                (click)="addQuestion('essay')">
          {{ 'quiz.add_essay_question' | transloco }}
        </button>
      
        <button type="submit"
                class="btn btn-success mt-3 p-3">
          {{ 'quiz.save' | transloco }}
        </button>
      </div>
      
         
        </form>
      </div>
      
    </div>
  </div>
</div>

      
      <!-- Modal -->
     <!-- <div class="custom-modal-backdrop" *ngIf="modalVisible"> -->
  <!-- <div class="custom-modal">
    <div class="modal-header d-flex justify-content-between align-items-center">
      <h5 class="modal-title">{{ selectedQuiz?.title }}</h5>
      <button type="button" class="btn-close" aria-label="Close" (click)="closeModal()"></button>
    </div>
    <div class="modal-body">
      <p><strong>اسم الكورس:</strong> {{ selectedQuiz?.title }}</p>
      <p><strong>الوصف:</strong> {{ selectedQuiz?.description }}</p>
      <p><strong>نوع الاختبار:</strong> {{ selectedQuiz?.type === 1 ? 'اختيار من متعدد' : 'مقالي' }}</p>
      <p><strong>النسبة المطلوبة للنجاح:</strong> {{ selectedQuiz?.passingPercentage }}%</p>
      <p><strong>عدد المحاولات:</strong> {{ selectedQuiz?.attemptsAllowed }}</p>
      <p><strong>المدة:</strong> {{ selectedQuiz?.timeLimitInMinutes }} دقيقة</p>
      <p><strong>مجاني؟</strong> {{ selectedQuiz?.isFree ? 'نعم' : 'لا' }}</p>
      <p *ngIf="!selectedQuiz?.isFree"><strong>السعر:</strong> {{ selectedQuiz?.price }} جنيه</p>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeModal()">إغلاق</button>
    </div>
    
    <div class="row">
      <div class="col-md-4" *ngFor="let quiz of quizzes">
        <div class="card mb-3">
          <img src="assets/quiz.jpg" class="card-img-top" alt="quiz image">
          <div class="card-body">
            <h5 class="card-title">{{ quiz.title }}</h5>
            <button class="btn btn-primary" (click)="openModal(quiz)">عرض التفاصيل</button>
          </div>
        </div>
      </div>
    </div>
    

  </div> -->


</div>
</div>
